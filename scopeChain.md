# js作用域链

要理解js的作用域链的概念，首先需要理解一个执行环境的概念。所谓执行环境是在代码在运行时所依赖的环境，比如全局代码在执行时
所依赖的全局环境。同时执行环境还有一个与之关联的变量对象，环境中定义的变量和函数都包含在这个对象内。但我们自身编写的代码
无法访问到这个对象，只有js解释器在后台处理数据时才会用到它。

全局执行环境是最外层的执行环境。根据js运行时的宿主环境的不同，在浏览器端全局执行环境就是window对象，在node端全局执行环境
就是global对象。无论是哪一种宿主环境，全局变量和函数都是依附于这个全局执行环境中的。当js脚本启动时，我们就可以在代码中
随意使用挂载在全局执行环境中的对象和相应的方法，比如Math对象的方法，Math.abs(-2),String对象的str.length()方法。这些对象
和方法之所以不用声明就能调用，是因为在脚本启动的时候，它们已经自动挂载到全局执行环境中了，因此可以在脚本里任意的使用。
同时在全局对象里声明的变量和函数也会挂载到这个全局执行环境中，被其他代码访问到。

在作用域那一节我已经提到js函数是可以访问到全局对象里定义的变量的。以代码为例
```javascript
var a =  1;
function add(){
  var b = 2;
  console.log(a + b);
}
add();
```
调用add函数的结果输出3。而函数内部并没有定义一个变量a。其实在函数add调用时，js解释器会创建一个与之相关联的变量对象，用于存放函数所需的变量。上面的代码中，add函数的变量对象就存放着变量b。全局环境的变量对象里存放着变量a。函数add运行时需要依赖变量a和变量b,变量b在add函数的变量对象里可以找到，而变量a却并不在add函数的变量对象里，此时js解释器就是向
上查找。由于add函数的上一层环境就是全局环境，所以解释器会在全局环境的变量对象里查找是否存在变量a,结果找到了变量a。
add函数就能正确执行。这种变量的查找机制其实就是作用域链。根据就近原则，逐步向上查找，如果找到就停止搜索，一环紧扣一环。如果一直到全局环境里也没有查找到相应的变量，就会报undefined的错误。
